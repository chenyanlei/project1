/* Date: 2015-08-27T14:52:59Z Path: js/deal/deal_main.js */
define("deal_wish",function(e,a,t){"use strict";var i="";i+='<form class="mobile_subscribe" action="post" id="subscribe_form">',i+='<span class="wish_act_close"></span>',i+='<div class="onsale_layer" id="onsale_start" style="display:none;">',i+='<p class="onsale_tit" id="addWishTit">加入心愿单</p>',i+='<div class="onsale_layer_wrap">',i+='<p class="onsale_layer_tips">请绑定手机号，获取特卖提醒！</p>',i+='<div class="onsale_input_wrap">',i+='<label for="mobile">手机号：</label>',i+="<i></i>",i+='<input name="mobile" id="mobile" class="onsale_mobile" type="text" maxlength="11">',i+='<input name="get_confirm_code" diff="20" id="get_confirm_code" type="button" value="获取手机校验码" class="get__wish_confirm_code">',i+='<div class="onsale_act grey onsale_layer_err">请输入正确的11位手机号码</div>',i+="</div>",i+='<div class="onsale_input_wrap">',i+='<label for="confirm_code">校验码：</label>',i+="<i></i>",i+='<input name="confirm_code" id="confirm_code" type="text" class="onsale_mobile" maxlength="6">',i+='<div class="onsale_act grey onsale_layer_err"></div>',i+="</div>",i+='<div class="onsale_input_wrap onsale_btn_wrap">',i+='<label for="confirm_code">&nbsp;</label><input type="button" value="绑定" class="submit_subscribe" id="bind_act_wish" name="rebind">',i+="</div>",i+="</div>",i+="</div>",i+='<div class="onsale_layer" id="onsale_success" style="display: none;">',i+='<p class="onsale_tit">订阅成功</p>',i+='<div class="onsale_layer_wrap">',i+='<p class="onsale_layer_tips success_tips"><i></i>成功加入心愿单！</p>',i+='<div class="ok_wrap">',i+="小美会在特卖前第一时间发送短信通知至：<br>",i+='<b id="onsale_phone"></b>',i+="</div>",i+='<p class="onsale_cancel"><a href="http://www.jumei.com/i/wishdeal/willsale" target="_blank">设置已订阅的特卖提醒</a></p>',i+='<div class="onsale_btn_wrap mt5">',i+='<input type="button" value="确定" class="submit_subscribe close_dialog" name="rebind">',i+="</div>",i+="</div>",i+="</div>",i+='<input type="hidden" name="wait_time" id="wait_time">',i+='<div class="onsale_layer" id="bind_success" style="display: none;">',i+='<p class="onsale_tit">开通成功</p>',i+='<div class="onsale_layer_wrap">',i+='<p class="onsale_layer_tips success_tips"><i></i>成功开通短信提醒！</p>',i+='<div class="ok_wrap">',i+="小美会在特卖前第一时间发送短信通知至：<br>",i+='<b id="bind_phone"></b>',i+="</div>",i+='<p class="onsale_cancel"><a href="http://www.jumei.com/i/wishdeal/willsale" target="_blank">设置已订阅的特卖提醒</a></p>',i+='<div class="onsale_btn_wrap mt5">',i+='<input type="button" value="确定" class="submit_subscribe close_dialog" name="rebind">',i+="</div>",i+="</div>",i+="</div>",i+="</form>";var s=/^(((13[0-9]{1})|15[0-9]{1}|18[0-9]{1}|14[0-9]{1})+\d{8})$/,l={error:["请输入正确的11位手机号码","请先获取手机校验码！","手机校验码输入错误!","请输入手机校验码！"],successInfo:["手机校验码已经发送到您的手机",",请注意查收"],buttonInfo:["获取手机校验码","秒后重新发送"]},r=$("body"),n=60,o=!1,d=function(e){var a=$("#mobile"),t=$("#get_confirm_code"),i=null;0>=n&&clearInterval(i),e===!0?a.removeClass("onsale_disabled"):i=setInterval(function(){0>=n?(n=60,clearInterval(i),a.removeAttr("readonly").removeAttr("disabled"),t.val(l.buttonInfo[0]).removeClass("onsale_disabled")):(n--,t.val(n+l.buttonInfo[1]))},1e3)},c=function(){var e=decodeURIComponent(Jumei.util.cookie.get("nickname")),a=!0;return""===e&&(a=!1),a},_=function(e){var a=$("#mobile"),t=$("#get_confirm_code"),i="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/usermobile/prebind?",s=function(i){var s=parseInt(i.errno),r=i.message;0!==s?(e.html(r).css({color:"#ed155b"}),t.removeClass("onsale_disabled")):(r=l.successInfo[0]+"<strong>"+a.val()+"</strong>"+l.successInfo[1],e.html(r).css({color:"#ed155b"}),d(!1),o=!0)},r=a.val();$.ajax({url:i,data:{mobile:r},dataType:"jsonp",success:function(e){s(e)},error:function(){alert("请求错误，请刷新重试！")}})},u=function(){var e="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/usermobile/bind_jsonp?",a=$("#mobile"),t=$("#confirm_code").val(),i=($("#bind_phone"),$("#confirm_code").next(".onsale_layer_err")),s=$("#mobile").val();$.ajax({url:e,data:{mobile:s,code:t},dataType:"jsonp",success:function(e){0!==e.errno?(a.removeAttr("readonly").removeAttr("disabled"),i.html(e.message).css({color:"#ed155b"})):m.getWishAjax()},error:function(){alert("请求错误，请刷新重试！")}})},p=function(e){var a=$("#mobile"),t=$("#get_confirm_code"),i=a.parents(".onsale_input_wrap"),r=$("#confirm_code"),n=r.parents(".onsale_input_wrap"),d=t.next(".onsale_layer_err"),c=r.next(".onsale_layer_err"),p=$.trim(a.val());s.test(p)?(d.html(""),i.removeClass("onsale_err"),"undefined"==typeof e&&(t.addClass("onsale_disabled"),_(d))):(i.addClass("onsale_err"),d.html(l.error[0]),a.removeClass("onsale_disabled"),a.trigger("focus")),e&&(0===r.val().length?(n.addClass("onsale_err"),c.html(l.error[1])):6!==r.val().length?(n.addClass("onsale_err"),c.html(l.error[2])):(n.removeClass("onsale_err"),c.html(""),o===!0?(a.attr("readonly","readonly").attr("disabled","true"),u()):(n.addClass("onsale_err"),c.html(l.error[2]))))};$(document).on("click",".wish_act_close,.close_dialog",function(){window.wishTargetDialog.close()}),$(document).on("click","#get_confirm_code",function(){var e=$(this);e.hasClass("onsale_disabled")||p()}),$(document).on("click","#bind_act_wish",function(){$(this);p(!0)});var m={};m={init:function(e){this.options=e,this.getUserAjax()},getWishAjax:function(){var e=this,a="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/wishdeal/ajax_add_jsonp?item="+e.options.sku_no+","+e.options.hash_id+",1";$.ajax({url:a,dataType:"jsonp",success:function(e){0!==e.errno?alert("请求错误，请刷新重试！"):($("#onsale_start").hide(),$("#onsale_success").show(),$("#onsale_phone").html(e.data.mobile),r.trigger("wishAddCart"))},error:function(){alert("请求错误，请刷新重试！")}})},getUserAjax:function(){var e=this,a="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/account/ajax_is_mobile_bind2?",t=window.location.href,s=c();return s?(r.data("wish_loaded")||r.append(i),"undefined"==typeof window.wishTargetDialog&&(window.wishTargetDialog=new Jumei.ui.Dialog("body",{elem:$("#subscribe_form"),trigger:"wishAddCart"})),void $.ajax({url:a,dataType:"jsonp",success:function(a){1===a.is_login?0===a.is_bind?($("#onsale_success").hide(),$("#bind_success").hide(),$("#onsale_start").show(),r.trigger("wishAddCart")):e.getWishAjax():window.location.href="http://passport.jumei.com/i/account/login?redirect="+t}})):void(window.location.href="http://passport.jumei.com/i/account/login?redirect="+t)}},t.exports=m}),define("deal_koubei",function(e,a,t){"use strict";!function(e){function a(e,a){var t=(65535&e)+(65535&a),i=(e>>16)+(a>>16)+(t>>16);return i<<16|65535&t}function t(e,a){return e<<a|e>>>32-a}function i(e,i,s,l,r,n){return a(t(a(a(i,e),a(l,n)),r),s)}function s(e,a,t,s,l,r,n){return i(a&t|~a&s,e,a,l,r,n)}function l(e,a,t,s,l,r,n){return i(a&s|t&~s,e,a,l,r,n)}function r(e,a,t,s,l,r,n){return i(a^t^s,e,a,l,r,n)}function n(e,a,t,s,l,r,n){return i(t^(a|~s),e,a,l,r,n)}function o(e,t){e[t>>5]|=128<<t%32,e[(t+64>>>9<<4)+14]=t;var i,o,d,c,_,u=1732584193,p=-271733879,m=-1732584194,h=271733878;for(i=0;i<e.length;i+=16)o=u,d=p,c=m,_=h,u=s(u,p,m,h,e[i],7,-680876936),h=s(h,u,p,m,e[i+1],12,-389564586),m=s(m,h,u,p,e[i+2],17,606105819),p=s(p,m,h,u,e[i+3],22,-1044525330),u=s(u,p,m,h,e[i+4],7,-176418897),h=s(h,u,p,m,e[i+5],12,1200080426),m=s(m,h,u,p,e[i+6],17,-1473231341),p=s(p,m,h,u,e[i+7],22,-45705983),u=s(u,p,m,h,e[i+8],7,1770035416),h=s(h,u,p,m,e[i+9],12,-1958414417),m=s(m,h,u,p,e[i+10],17,-42063),p=s(p,m,h,u,e[i+11],22,-1990404162),u=s(u,p,m,h,e[i+12],7,1804603682),h=s(h,u,p,m,e[i+13],12,-40341101),m=s(m,h,u,p,e[i+14],17,-1502002290),p=s(p,m,h,u,e[i+15],22,1236535329),u=l(u,p,m,h,e[i+1],5,-165796510),h=l(h,u,p,m,e[i+6],9,-1069501632),m=l(m,h,u,p,e[i+11],14,643717713),p=l(p,m,h,u,e[i],20,-373897302),u=l(u,p,m,h,e[i+5],5,-701558691),h=l(h,u,p,m,e[i+10],9,38016083),m=l(m,h,u,p,e[i+15],14,-660478335),p=l(p,m,h,u,e[i+4],20,-405537848),u=l(u,p,m,h,e[i+9],5,568446438),h=l(h,u,p,m,e[i+14],9,-1019803690),m=l(m,h,u,p,e[i+3],14,-187363961),p=l(p,m,h,u,e[i+8],20,1163531501),u=l(u,p,m,h,e[i+13],5,-1444681467),h=l(h,u,p,m,e[i+2],9,-51403784),m=l(m,h,u,p,e[i+7],14,1735328473),p=l(p,m,h,u,e[i+12],20,-1926607734),u=r(u,p,m,h,e[i+5],4,-378558),h=r(h,u,p,m,e[i+8],11,-2022574463),m=r(m,h,u,p,e[i+11],16,1839030562),p=r(p,m,h,u,e[i+14],23,-35309556),u=r(u,p,m,h,e[i+1],4,-1530992060),h=r(h,u,p,m,e[i+4],11,1272893353),m=r(m,h,u,p,e[i+7],16,-155497632),p=r(p,m,h,u,e[i+10],23,-1094730640),u=r(u,p,m,h,e[i+13],4,681279174),h=r(h,u,p,m,e[i],11,-358537222),m=r(m,h,u,p,e[i+3],16,-722521979),p=r(p,m,h,u,e[i+6],23,76029189),u=r(u,p,m,h,e[i+9],4,-640364487),h=r(h,u,p,m,e[i+12],11,-421815835),m=r(m,h,u,p,e[i+15],16,530742520),p=r(p,m,h,u,e[i+2],23,-995338651),u=n(u,p,m,h,e[i],6,-198630844),h=n(h,u,p,m,e[i+7],10,1126891415),m=n(m,h,u,p,e[i+14],15,-1416354905),p=n(p,m,h,u,e[i+5],21,-57434055),u=n(u,p,m,h,e[i+12],6,1700485571),h=n(h,u,p,m,e[i+3],10,-1894986606),m=n(m,h,u,p,e[i+10],15,-1051523),p=n(p,m,h,u,e[i+1],21,-2054922799),u=n(u,p,m,h,e[i+8],6,1873313359),h=n(h,u,p,m,e[i+15],10,-30611744),m=n(m,h,u,p,e[i+6],15,-1560198380),p=n(p,m,h,u,e[i+13],21,1309151649),u=n(u,p,m,h,e[i+4],6,-145523070),h=n(h,u,p,m,e[i+11],10,-1120210379),m=n(m,h,u,p,e[i+2],15,718787259),p=n(p,m,h,u,e[i+9],21,-343485551),u=a(u,o),p=a(p,d),m=a(m,c),h=a(h,_);return[u,p,m,h]}function d(e){var a,t="";for(a=0;a<32*e.length;a+=8)t+=String.fromCharCode(e[a>>5]>>>a%32&255);return t}function c(e){var a,t=[];for(t[(e.length>>2)-1]=void 0,a=0;a<t.length;a+=1)t[a]=0;for(a=0;a<8*e.length;a+=8)t[a>>5]|=(255&e.charCodeAt(a/8))<<a%32;return t}function _(e){return d(o(c(e),8*e.length))}function u(e,a){var t,i,s=c(e),l=[],r=[];for(l[15]=r[15]=void 0,s.length>16&&(s=o(s,8*e.length)),t=0;16>t;t+=1)l[t]=909522486^s[t],r[t]=1549556828^s[t];return i=o(l.concat(c(a)),512+8*a.length),d(o(r.concat(i),640))}function p(e){var a,t,i="0123456789abcdef",s="";for(t=0;t<e.length;t+=1)a=e.charCodeAt(t),s+=i.charAt(a>>>4&15)+i.charAt(15&a);return s}function m(e){return unescape(encodeURIComponent(e))}function h(e){return _(m(e))}function f(e){return p(h(e))}function b(e,a){return u(m(e),m(a))}function g(e,a){return p(b(e,a))}function w(e,a,t){return a?t?b(a,e):g(a,e):t?h(e):f(e)}"function"==typeof define&&define.amd?define(function(){return w}):e.md5=w}(window);var i={};i={keyVal:"2e71b087c883dd2fa7b3d405b5db808fc372f49703dd51c5b802e381031b522e",getMD5Val:function(e){var a=this.keyVal,t=this.time,i=e;return window.md5(i+a+t)},url:function(e){var a="http://koubei.jumei.com/Ajax/getDealDatasByProductId",t=this.getMD5Val(e);return a+"?product_id="+e+"&verify_code="+t+"&time="+this.time},getHtml:function(e){var a="",t='<div class="deal_new_buynum_word"><i class="deal_buy_icon2"></i><p>新品尝鲜,快来试试吧!</p></div>';if("0"===e.status){e=e.data;var i=((e.rating-e.averageRating)/e.averageRating,0);if(parseInt(e.productReportNumber)<=i)a+=t,a+="",$("#report_deal_type").remove();else{var s=parseInt(e.dealCommentNumber)+parseInt(e.productReportNumber);a+='<div class="deal_new_buynum_word">',a+='<i class="deal_buy_icon2"></i>',a+='<div class="deal_new_star_count">'+e.rating+"分",a+=window.DealDetail.global.isCloseRecommendation.koubei?'(<a class="koubei_no">'+s+"条评价)</a>":'(<a id="koubei_report_newdeal" href="#report_deal_show">'+s+"条评价)</a>",a+="</div>",a+="</div>",$("#report_deal_type").show()}}else a+=t,$("#report_deal_type").remove();this.parent.append(a)},getAjax:function(e){var a=this,t=a.url(e.value);$.ajax({dataType:"jsonp",jsonp:"callback",url:t,success:function(e){a.getHtml(e)}})},init:function(){this.time=(new Date).getTime(),this.parent=$(".deal_koubei");var e=window.DealDetail.global.productId;this.getAjax({value:e})}},t.exports=i}),define("deal_tab_fixed",function(e,a,t){"use strict";var i={};i.init=function(){var e=$(".product_tabs_content"),a=$(".tabs-detail-title"),t=new Jumei.ui.Anchorbar(e,{height:"30"});t.on("fixedstart",function(){e.addClass("nav_bar_fixed").css({width:"100%",left:"0px"}),a.show()}).on("fixedend",function(){e.removeClass("nav_bar_fixed").css({width:"",left:""}),a.hide()})},t.exports=i}),define("deal_wish_cart",["deal_wish"],function(e,a,t){"use strict";var i=e("deal_wish"),s=$(document),l="http://cart."+window.DealDetail.global.siteCartTopLevelDomainName+"/i/presale/add/",r=function(e){var a=window.location.href;return new RegExp(".+"+e+"=([^&]+).*","gi").test(a)?RegExp.$1:""},n={};n={init:function(e){this.options=e,this.dealSku(),this.addCartEvent(),this.addWishEvent(),this.addBookingEvent()},addBookingEvent:function(){var e=$(".deal_button_list"),a=$(".deal_product_sort_r"),t=$(".product_tabs_right"),i=$(".select_pro_content");e.on("click",".deal_sale_forms_money",function(){var e=$("#sku_no").val();""===e&&(a.css({display:"block"}),i.addClass("warn_border_red"))}),t.on("click",".deal_book_money",function(e){var a=$(".deal_tab_wishe_select");a.length>0&&(a.show(),e.stopPropagation())})},dealSku:function(){var e=$("#p_rule_size"),a=$("#sku_all_detail"),t=$("#selected_elem"),i=($.trim(t.html()),$(".select_all_list")),r=$(".deal_product_sort_r"),n=($("#footer_more_sku"),$(".select_pro_content")),o=this,d=$("#go_to_cart"),c=$(".p_sort_selected"),_=$(".deal_tab_wishe_select"),u=$("#sku_no"),p=this.options.ostatus;i.length<=0||(e.show(),a.on("click",".p_sort_selected",function(){var e=$(this),a=$(".select_all_list");return e.hasClass("p_sort_current")?(a.hide(),e.removeClass("p_sort_current")):(e.addClass("p_sort_current"),a.show()),n.removeClass("warn_border_red"),r.hide(),!1}),s.click(function(){i.hide(),c.removeClass("p_sort_current")}),i.delegate("a","click",function(e){var a=$(this),i=a.find("span").html(),s=a.attr("data-hashid");6===p&&d.attr("href",l+s+","+window.DealDetail.global.hashId+",1"),a.hasClass("data-disable")?e.stopPropagation():a.hasClass("cur")?(a.removeClass("cur"),u.val("")):(t.html(i),a.addClass("cur").siblings("a").removeClass("cur"),u.val(s))}),_.on("click","a",function(){var e=$(this),a=$("#foot_car_btn"),t=e.attr("data-hashid");n.removeClass("warn_border_red"),r.css({display:"none"}),e.hasClass("data-disable")?event.stopPropagation():(e.hasClass("cur")?(e.removeClass("cur"),u.val("")):(e.addClass("cur").siblings("a").removeClass("cur"),u.val(t),a.hasClass("deal_add_cart")?o.addCart(a,"addcart_bottom"):a.hasClass("deal_add_wish")&&o.addWish()),o.initEleStatus())}))},addCart:function(e,a){var t=$("#sku_no"),i=t.val(),s=$("#detail_main_img").attr("src"),l=$(".deal_product_sort_r"),n=r("from"),o=$(".select_pro_content"),d=window.DealDetail.global.hashId;if((void 0===window.DealDetail.global.isCloseRecommendation.clickMap||window.DealDetail.global.isCloseRecommendation.clickMap===!1)&&window.StreamUtil.init($("#stream_id"),{fb_type:1}),""===i)l.css({display:"block"}),o.addClass("warn_border_red");else{var c={elem:e,img:s,sku:i,hashid:d,num:1,from:n,which_cart:a};Jumei&&Jumei.app&&Jumei.app.iBar&&Jumei.app.iBar.addCart(c)}},initEleStatus:function(){var e=$(".select_all_list").find("a"),a=$(".deal_tabs_wisha").find("a"),t=$("#selected_elem"),i=$("#go_to_cart"),s=$("#sku_no"),l=(s.val(),function(e){var a=$(e);a.hasClass("cur")&&a.removeClass("cur")});e.each(function(){l(this)}),a.each(function(){l(this)}),s.val(""),i.removeAttr("href"),t.html("请选择型号")},addWish:function(){var e=$("#sku_no"),a=e.val(),t=$(".deal_product_sort_r"),s=$(".select_pro_content"),l=window.DealDetail.global.hashId;""===a?(t.css({display:"block"}),s.addClass("warn_border_red")):(i.init({sku_no:a,hash_id:l}),(void 0===window.DealDetail.global.isCloseRecommendation.clickMap||window.DealDetail.global.isCloseRecommendation.clickMap===!1)&&window.StreamUtil.init($("#stream_id"),{fb_type:4}))},addCartEvent:function(){var e=this,a=$(".deal_tab_wishe_select"),t=$(".deal_button_list"),i=$(".product_tabs_right");t.on("click",".deal_button_cart",function(){var a=$(this);e.addCart(a,"addcart_top")}),i.on("click",".deal_add_cart",function(t){t.stopPropagation();var i=$(this),s=$(".deal_tab_wishe_select");s.length?a.show():e.addCart(i,"addcart_bottom")}),$(document).click(function(){a.hide()})},addWishEvent:function(){var e=$(".deal_button_list"),a=$(".deal_tab_wishe_select"),t=this;e.on("click",".deal_button_wish",function(){t.addWish()}),$(".product_tabs_right").on("click",".deal_add_wish",function(e){e.stopPropagation();$("#sku_no").val();a.length>0?a.show():t.addWish()})}},t.exports=n}),define("deal_fav",function(e,a,t){"use strict";var i={};i={defaultData:{notlogin:'您还没有登录,<a class="txt-deco" href="http://passport.jumei.com/i/account/login">登录</a> 后才能添加我喜欢'},timer:null,clearHtml:function(e){var a=this;clearTimeout(a.timer),a.timer=setTimeout(function(){a.parent.html("").css({display:"none"})},e)},notOKLogin:function(){var e=this,a=e.defaultData.notlogin;e.parent.html(a).css({display:"block"}),e.clearHtml(5e3)},isOkLogin:function(){var e=$("#btnilike"),a=$("#ilike_text"),t=$("#ilike_num"),i=parseInt(t.text())+1;e.addClass("liked").removeAttr("href").unbind("click"),a.text("已收藏"),t.text(i),(void 0===window.DealDetail.global.isCloseRecommendation.clickMap||window.DealDetail.global.isCloseRecommendation.clickMap===!1)&&window.StreamUtil.init($("#stream_id"),{fb_type:2})},isFailLogin:function(e){var a=this;a.parent.css({display:"block"}).html(e.msg),a.clearHtml(2e3)},isOrNotLogin:function(){var e=window.DealDetail.global.productId,a="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/product/ajax_fav_product?product_id="+e+"&callback=?",t=this;$.getJSON(a,function(e){"no"===e.isLogin?t.notOKLogin():"yes"===e.isOk?t.isOkLogin():"no"===e.isOk&&t.isFailLogin(e)})},drawDataNum:function(){var e=$("#ilike_num"),a=$("#btnilike"),t=$("#ilike_text"),i=this.options.fav_number,s=this.options.is_fav;e.html(i),s&&(a.addClass("liked"),t.html("已收藏"))},init:function(e){this.options=e,this.drawDataNum();var a=$("#btnilike"),t=this;t.parent=$(".fav-ibtn-back"),a.on("click",function(){var e=$(this);e.hasClass("liked")||t.isOrNotLogin(e)})}},t.exports=i}),define("deal_group_buy",["deal_tab_fixed","deal_koubei"],function(e,a,t){"use strict";var i=e("deal_tab_fixed"),s=e("deal_koubei"),l=2,r={often_buy:{title:"大家经常这样购买",from:"r_d_ag",url:"/i/ajax/get_deal_recommend_group"},introduce_buy:{title:"买了此商品用户还买了",from:"r_d_ab",url:"/i/ajax/view_also_buy"}},n=window.DealDetail.global.productId,o="fit_tit01",d=$("#deal_group_buy"),c=function(e){e.find("img").each(function(){var e=$(this),a=e.attr("lazy-src");a&&e.attr("src",a)})},_=function(e){var a=window.location.href;return new RegExp(".+"+e+"=([^&]+).*","gi").test(a)?RegExp.$1:null},u=function(e){var a=0,t=0,i=$("#fit_tit"+e+" input:checked"),s=i.length;if(s>0)for(var l=0;s>l;l++)t+=parseFloat(i[l].getAttribute("discounted_price")),a+=parseFloat(i[l].getAttribute("original_price"));t=Math.round(100*t)/100,a=Math.round(100*a)/100;var r=Math.round(100*(a-t))/100;$("#discounted_price_sum_"+e).html("¥"+t),$("#original_price_sum_"+e).html("¥"+a),$("#save_price_sum_"+e).html("¥"+r),$("#select_count_"+e).html(s)},p=function(){$("#groupBuyBtn").on("click",function(e){for(var a,t,i,s=$("#fit_tit01 input:checked"),l=$("#firstGroupImg")[0].src,r=_("from"),n=s.length,o=[],d=[],c=[],u=0;n>u;u++){if(a=s[u].value,t=$("#fit_tit01_"+a+" :selected"),""===t[0].value)return void alert("请选择型号！");i=t[0].value.split(","),o.push(i[0]),d.push(i[1]),c.push(i[2])}window.Jumei&&window.Jumei.app&&Jumei.app.iBar.addCart({elem:this,img:l,sku:o,hashid:d,num:c,from:r,multiple:!0,which_cart:"group"}),e.preventDefault()}),d.on("click",".J_CheckBox",function(){u("01")})},m=function(e){var a="",t=r.often_buy.from,i=0,s=0,l=e.length;a+='<h2 class="deal_group_tt"><span>'+r.often_buy.title+"</span></h2>",a+='<div class="group_list clearfix" id="fit_tit01">',a+='<div class="newdeal_fit_singles">';for(var c=0;l>c;c++){var _,u="",m=e[c],h=m.detailUrl,f=m.imgUrl,b=m.hash_id,g=b&&""!==b?b:m.product_id,w=b&&""!==b?m.short_name:m.product_short_name,v=b&&""!==b?m.original_price:m.market_price,y=b&&""!==b?m.discounted_price:m.mall_price,k=(b&&""!==b?m.hash_id:m.product_id,b&&""!==b?b:""),$="",D="",x='<input type="checkbox" class="J_CheckBox" name="related_index" value="'+g+'" original_price="'+v+'" discounted_price="'+y+'" checked="checked"><span class="check_price en">¥'+y+"</span>",I=o+"_"+g;if(_=b?m.sku_count>=1?m.skus:{}:m.sku_count>=1?m.all_sku:{},m.sku_count>1){$='<select id="'+I+'"><option value="">请选择</option>';for(var A in _)$+='<option value="'+_[A].sku_no+","+k+',1">'+(void 0===_[A].sku_attributes?_[A].attr:_[A].sku_attributes)+"</option>"}else{for(var j in _)D=j;$='<select id="'+I+'" style="display:none;"><option value="'+D+","+k+',1"></option>'}$+="</select>",0===c&&(u='style="display:none"'),a+='<div class="newdeal_fit_single"><a href="'+h+"?from="+t+"_"+n+"_1-"+(parseInt(c)+1)+'" target="_blank" class="pic"><img id="firstGroupImg" lazy-src="'+f+'" alt="'+w+'"></a><p class="name"><a href="'+h+'" target="_blank">'+w+'</a></p><p class="checkbox" '+u+">"+x+'</p><p class="type">'+$+"</p></div>"+(c<e.length-1?'<div class="newdeal_fit_add">+</div>':""),i+=parseFloat(y),s+=parseFloat(v)}a+="</div>",a+='<div class="newdeal_fit_add">=</div><div class="newdeal_fit_all"><p><b>已选择<span class="num" id="select_count_01">'+1*c+'</span>个产品</b></p><div class="newdeal_fit_allinfo"><p>聚美总价：<span class="price en" id="discounted_price_sum_01">¥'+Math.round(100*i)/100+'</span></p><p>参考总价：<span style="text-decoration: line-through;" id="original_price_sum_01">¥'+Math.round(100*s)/100+'</span></p><p>为您节省：<span id="save_price_sum_01">¥'+Math.round(100*(s-i))/100+'</span></p></div><a href="javascript:void(0)" class="group_buy_button" id="groupBuyBtn" rel="nofollow" tab="recommendation" pid="'+n+'"><img src="http://p0.jmstatic.com/templates/jumei/images/newdeal/fit_btn.jpg" /></a></div>',a+="</div>",d.html(a).css({display:"block"}),p()},h=function(e){var a="",t=r.introduce_buy.from,i=e.length;a+='<h2 class="deal_group_tt"><span>'+r.introduce_buy.title+"</span></h2>",a+='<div class="group_list clearfix">';for(var s=0;i>s;s++){var l=e[s],o=l.url,c=l.image_200,_=l.hash_id,u=(_&&""!==_?_:l.product_id,_&&""!==_?l.short_name:l.product_short_name),p=_&&""!==_?l.discounted_price:l.mall_price;a+='<div class="newdeal_fit_single newdeal_fit_single_buymore"><a href="'+o+"?from="+t+"_"+n+"_1-"+(parseInt(s)+1)+'" target="_blank" class="pic"><img lazy-src="'+c+'" alt="'+u+'"></a><p class="name"><a href="'+o+"?from="+t+"_"+n+"_1-"+(parseInt(s)+1)+'" target="_blank">'+u+'</a></p><p class="checkbox en">¥'+p+"</p></div>"}a+="</div>",d.html(a).css({display:"block"})},f=function(e){var a=(r[e].from,r[e].title,"often_buy"===e?{pid:n}:{pids:n,limit:5}),t="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+r[e].url;$.ajax({url:t,dataType:"jsonp",jsonp:"callback",data:a,success:function(a){a&&a.length>0&&("often_buy"===e?m(a):"introduce_buy"===e&&h(a)),i.init()},complete:function(){c(d)},error:function(){i.init()}})},b={};b={init:function(e){l=e.isSale,2!==l||window.DealDetail.global.isCloseRecommendation.groupBuy?3!==l&&4!==l||window.DealDetail.global.isCloseRecommendation.groupBuy?i.init():f("introduce_buy"):f("often_buy"),s.init()}},t.exports=b}),define("deal_air_bubble",function(e,a,t){"use strict";var i={};i={commonArray:{},iNum:0,getIndexHmtl:function(e){var a;switch(e){case 1:a={first:"顾客",second:"正在浏览本商品"};break;case 0:a={first:"后预计",second:"本商品被抢光"};break;case 2:a={first:"顾客正在将",second:"商品加入购物车"};break;case 3:a={first:"该商品最近1天",second:"售出超过",third:"人"}}return a},getHtml:function(){for(var e=[],a=this.commonArray,t=$(".air_bubble"),i=0,s=0;i<a.length;i++){var l=a[i],r=this.getIndexHmtl(i);0===i?(s=l,s>0&&10>=s&&e.push('<li data-num="'+i+'"><div class="air_bb_ul_cn"><p><span class="air_red">5分钟</span>'+r.first+"</p><p>"+r.second+'</p></div><i class="air_bb_icon2"></i></li>')):1===i?l>=500&&e.push('<li data-num="'+e.length+'"><div class="air_bb_ul_cn"><p> <span class="air_red">'+l+"位</span>"+r.first+"</p><p>"+r.second+'</p></div><i class="air_bb_icon2"></i></li>'):2===i&&l>=50&&e.push('<li data-num="'+e.length+'"><div class="air_bb_ul_cn"><p><span class="air_red">'+l+"位</span>"+r.first+"</p><p>"+r.second+'</p></div><i class="air_bb_icon2"></i></li>')}e.length<=0&&t.remove(),this.showOneAnimate(e)},iTimer:null,showOneAnimate:function(e){var a=this,t=-1,i=$(a.elem),s=$(".air_bubble"),l=0;this.iTimer=setInterval(function(){t+=1,l+=5,t<=e.length&&(i.append(e[t]),"none"===s.css("display")&&s.fadeIn(300),i.find("li").each(function(){var e=$(this),a=parseInt(e.attr("data-num"));t===a&&e.fadeIn(300)})),a.hideOneAnimate(l,e)},5e3)},hideOneAnimate:function(e,a){var t=this,i=$(t.elem),s=$(".air_bubble"),l=5*(a.length-1)+20;i.find("li").each(function(){{var a=$(this);5*a.attr("data-num")+20}e==l&&(s.fadeOut(300),clearTimeout(t.iTimer))})},getAjax:function(e,a){var t=this,i=window.DealDetail.global.hashId,s=window.DealDetail.global.productId,l=e.indexOf("product_id")<0?i:s,r="http://www.jumei.com"+e+l;$.ajax({url:r,jsonp:"callback",dataType:"jsonp",success:function(e){t.commonArray[a]=e.number,t.iNum++,t.commonArray.length=t.iNum,t.oUrl.length<=t.commonArray.length&&t.getHtml()}})},sortFunction:function(e){var a=e.url,t=($(e.ele),0);if($.isArray(a)===!0)for(;t<a.length;t++){var i=a[t];this.getAjax(i,t)}},setAirPostion:function(){var e=$(window),a=$(".air_bubble_list"),t=function(){var t=e.width();a.css(t>1280&&1366>=t?{right:"-5px"}:1280>=t?{right:"-51px"}:{right:"20px"})};e.resize(function(){t()}),t()},showFloatAir:function(){var e=$(".air_bubble"),a=$(".deal_img_sorts"),t=$(".air_bubble_cn"),i=($("body"),!!window.ActiveXObject),s=(i&&!window.XMLHttpRequest,a.offset().top+a.height()-e.height()-180),l=$(window),r=function(){var e=l.scrollTop();e>=s?t.addClass("ari_bubble_fix"):t.removeClass("ari_bubble_fix")};l.scroll(function(){r()}),r()},init:function(e){this.setAirPostion(),this.oUrl=e.url,this.elem=e.ele,this.sortFunction(e),this.showFloatAir()}},t.exports=i}),define("deal_booking",function(){"use strict";var e=($(document),$(".deal_product_detail")),a=$(".faleform_scales");e.on("mouseenter",".faleform_scales",function(){a.addClass("faleform_slideup")}).on("mouseleave",".faleform_scales",function(){a.removeClass("faleform_slideup")})}),define("shopping",function(e,a,t){"use strict";var i={};i={requireData:{},init:function(e){this.requireData=e,this.concactShopping()},dialogShopHtml:function(e,a){var t='<div class="mating_box_pop"><span class="mall_intro_close"></span><div class="mating_box_title">商城有售！</div><div class="mating_box"><a class="pic" href="http://mall.jumei.com/product_'+e.id+'.html?from=home_deal_deal2mall_rec" target="_blank"><img src="'+a+'"></a><div class="content" style="width:220px;"><h2 class="title"><a href="http://mall.jumei.com/product_'+e.id+'.html?from=home_deal_deal2mall_rec" target="_blank">'+e.title+'</a></h2><p class="discount"><span>参考价：'+e.market_price+'元</span></p><p class="price"><span>￥</span>'+e.mall_price+'</p><p class="action"><a href="http://mall.jumei.com/product_'+e.id+'.html?from=home_deal_deal2mall_rec" target="_blank"></a></p></div></div></div>';return t},topShopHtml:function(e,a){var t='<div class="deal_mating_box"><div class="mating_icon"></div><a href="http://mall.jumei.com/product_'+e.id+'.html?from=home_deal_deal2mall_rec" target="_blank"><img src="'+a+'" alt="" class="pic"></a><div class="title"><h2><a href="http://mall.jumei.com/product_'+e.id+'.html?from=home_deal_deal2mall_rec" target="_blank">'+e.title+'</a></h2><p class="grey"><span>参考价：'+e.market_price+'元</span></p></div><div class="time_box"><p class="from_mall">来自美妆商城</p></div><a class="to_mall" href="http://mall.jumei.com/product_'+e.id+'.html?from=home_deal_deal2mall_rec" target="_blank"><span>¥</span>'+e.mall_price+"</a></div>";return t},concactShopping:function(){{var e=this,a=this.requireData.sell_state,t=e.requireData.mall_product,i=$("#mall_product_box_deal"),s=$("body");"http://p0.jmstatic.com/templates/jumei/images".replace(/\/images/g,"")}if((3==a||4==a)&&!$.isEmptyObject(t)){var l=t.product_short_name,r=t.product_id,n=t.discount,o=t.market_price,d=t.mall_price,c=t.fake_30day_buyer_number,_={mallProduct:t,title:l,id:r,discount:n,market_price:o,mall_price:d,passBuyNum:c},u=e.topShopHtml(_,t.img_60),p=e.dialogShopHtml(_,t.img_160);i.html(u).find(".deal_mating_box").slideDown(300),s.append(p),window.shoppingIntroduce=new Jumei.ui.Dialog("body",{elem:".mating_box_pop",trigger:"ShowShoppingIntro"}),s.trigger("ShowShoppingIntro"),$(".mall_intro_close").on("click",function(){window.shoppingIntroduce.close()})}}},t.exports=i}),define("bottom_main",function(e,a,t){"use strict";var i={};i={requireData:{},init:function(e){this.requireData=e,this.zhenPinHtml(),this.dealAca(),this.dealDetailView(),window.DealDetail.global.isCloseRecommendation.groupBuy===!1&&this.newUserShow()},zhenPinHtml:function(){var e=this.requireData.zhen_pin.isShow,a=this.requireData.zhen_pin.flag,t=$("#zhenpin_flag_brand"),i=$("#zhenpin_flag_login"),s=$(".product-validate");e&&(s.css({display:"block"}),0===a?i.html("真品联盟"):1===a&&(t.html("品牌官网"),i.html("品牌")),s.find("textarea").each(function(){var e=$(this),a=e.val();e.length>0&&(s.html(a),e.remove())}),s.on("mouseenter",".product-validate-tab1 li",function(){var e=$(this),a=e.index();e.addClass("current").siblings("li").removeClass("current"),$(".product-validate-content").eq(a).css({display:"block"}).siblings(".product-validate-content").css({display:"none"})}))},dealAca:function(){var e=this.requireData,a={y:["品牌防伪码","支持真品联盟官网","http://hd.jumei.com/act/6-478-2230-aca.html","show_agree_icon31"],b:["品牌防伪码","支持品牌官网验真","http://hd.jumei.com/act/6-478-2230-aca.html","show_agree_icon3"]};if("y"===e.aca_info||"b"===e.aca_info){var t=$(".first_width3 .deal_agree_tt"),i=$(".first_width3 .deal_agree_dd"),s=$(".first_width3 i"),l=$(".first_width3 a");t.html(a[e.aca_info][0]),s.attr("class",a[e.aca_info][3]),i.html(a[e.aca_info][1]),l.attr("href",a[e.aca_info][2])}$(".first_width3").show()},newUserShow:function(){var e=Jumei.util.cookie.get("uid"),a=Jumei.util.cookie.get("first_visit"),t=Jumei.util.cookie.get("order_new_user");e&&""===t?$.getJSON("http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/ajax/new_user?callback=?",function(e){0!==e&&(t=Jumei.util.cookie.get("order_new_user"),$("#new_user_imgshow").hide(),$("#deal_newuser_view").show())}):(a&&!e||e&&1==t)&&($("#new_user_imgshow").hide(),$("#deal_newuser_view").show())},dealDetailView:function(){var e=this.requireData;e.zhen_pin.isShow||"y"!==e.aca_info&&"b"!==e.aca_info||$("#new_user_imgshow").prepend('<img src="http://p0.jmstatic.com/templates/jumei/images/zhenp.jpg" style="width:670px;margin:40px auto 0;"/>')}},t.exports=i}),define("top_main",["deal_booking","deal_air_bubble","deal_group_buy","deal_fav","deal_wish_cart"],function(e,a,t){"use strict";e("deal_booking");var i,s=e("deal_air_bubble"),l=e("deal_group_buy"),r=e("deal_fav"),n=e("deal_wish_cart"),o=function(e){var a=(e+"").length;return a>1?e:"0"+e},d="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/order/list/pre",c={format:'距特卖结束<em class="z">DD</em>天<em class="z">HH</em>:<em class="z">MM</em>:<em class="z">SS</em>',dtime:1e3,scroll:!1,onStart:function(){this.$target.html(this.html)},onEnd:function(){var e=$("#go_to_cart");e.attr("class","deal_button deal_button_soldout"),p.endTimeFull(),i.stop()}},_={format:'距预售结束<em class="z">DD</em>天<em class="z">HH</em>:<em class="z">MM</em>:<em class="z">SS</em>',dtime:1e3,scroll:!1,onStart:function(){this.$target.html(this.html)},onEnd:function(){var e=$("#go_to_cart");e.attr("class","deal_button deal_sale_forms_endbp"),p.endTimeFull(),i.stop()}},u={format:'距尾款结束<em class="z">DD</em>天<em class="z">HH</em>:<em class="z">MM</em>:<em class="z">SS</em>',dtime:1e3,scroll:!1,onStart:function(){this.$target.html(this.html)},onEnd:function(){p.endTimeFull(),i.stop()}},p={requireData:{},init:function(e){this.requireData=e,this.dealStopTime(),this.buttonStatus(),this.dealBuyNum(),this.salesRule(),this.skusEvent(),this.newUserRule(),this.priceHtmlDeal(),this.dealFav(),l.init({isSale:this.requireData.sell_state})},endTimeFull:function(){var e=this,a=this.requireData.sell_state,t=1e3*e.requireData.system_time,i=$("#go_to_cart"),s=$("#foot_car_btn"),l="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/deal/mobile_subscribe/?id="+window.DealDetail.global.productId,r=function(){var t;
switch(a){case 1:case 5:t=new Date(1e3*e.requireData.start_time);break;case 6:case 7:t=new Date(1e3*window.DealDetail.global.paymentStartTime);break;case 8:case 9:t=new Date(1e3*window.DealDetail.global.paymentEndTime);break;default:t=new Date(1e3*e.requireData.end_time)}return t},n=function(){var i=new Date(t),s=9===a||8===a?1e3*window.DealDetail.global.paymentEndTime:1e3*e.requireData.end_time,l=new Date(s),r=i.getMonth()+1+""+i.getDate(),n=l.getMonth()+1+""+l.getDate();return{eTime:r,syTime:n}},d=n(),c=r(),_=c.getFullYear(),u=o(c.getMonth()+1),p=o(c.getDate()),m=o(c.getHours()),h=o(c.getMinutes()),f="",b=$("#newdeal_timer");switch(a){case 3:f=d.eTime!==d.syTime?'抢光于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+"时":'抢光于<em class="z">今日</em><em class="z">'+m+"时";break;case 2:var g=$(".select_pro_content");f=d.eTime!==d.syTime?'抢光于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+"时":'抢光于<em class="z">今日</em><em class="z">'+m+"时",s.attr("class","buy deal_add_tell").attr("href",l),g.remove();break;case 1:case 5:f='将于<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+'</em>:<em class="z">'+h+"</em>开售";break;case 6:f='将于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+'</em>:<em class="z">'+h+"</em>开始支付尾款",i.attr("class","deal_button deal_sale_forms_endbp").removeAttr("href"),s.removeAttr("href"),$(".select_pro_content").length>0&&$(".select_pro_content").remove();break;case 7:f='将于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+'</em>:<em class="z">'+h+"</em>开始支付尾款";break;case 8:f=d.eTime!==d.syTime?'抢光于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+"时":'抢光于<em class="z">今日</em><em class="z">'+m+"时",i.attr("class","deal_button deal_sale_forms_end").removeAttr("href"),s.removeAttr("href"),$(".select_pro_content").length>0&&$(".select_pro_content").remove();break;case 9:f=d.eTime!==d.syTime?'抢光于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+'</em>日<em class="z">'+m+"时":'抢光于<em class="z">今日</em><em class="z">'+m+"时";break;default:f='抢光于<em class="z">'+_+'</em>年<em class="z">'+u+'</em>月<em class="z">'+p+"</em>日"}b.html(f)},dealStopTime:function(){var e,a=this,t=a.requireData.sell_state,s=a.requireData.system_time,l=a.requireData.start_time,r=a.requireData.end_time,n=1===a.requireData.sell_state?l-s:r-s,o=$("#newdeal_timer");switch(8===t&&(n=window.DealDetail.global.paymentEndTime-s),o.attr("diff",n+100),t){case 1:case 3:case 4:case 5:case 7:case 9:a.endTimeFull();break;case 6:e=$.extend({},_,{end_time:n});break;case 8:e=$.extend({},u,{end_time:n});break;default:e=$.extend({},c,{end_time:r})}"undefined"!=typeof e&&(i=new Jumei.ui.TimeCounter(o,e))},dealBooking:function(e){var a=$("#sale_step1_detail"),t=$("#sale_step3_detail"),i=($("#saleforms_step4"),window.DealDetail.global.startTime),s=window.DealDetail.global.endTime,l=this.requireData.surplusNumber,r=window.DealDetail.global.paymentStartTime,n=this.requireData.system_time,o=window.DealDetail.global.paymentEndTime,d=s>=n&&n>=i?s-n:o-n,c=function(e){var a,t,l,n,c,_;switch(e){case"before":a=i;break;case"start":a=r;break;case"end":a=o;break;case"dealEnd":a=s;break;case"have":a=d}return"have"===e?(l=0,n=Math.floor(d/86400),c=Math.floor((d-86400*n)/3600),_=Math.floor((d-86400*n-3600*c)/60)):(t=new Date(1e3*a),l=t.getMonth()+1,n=t.getDate(),c=t.getHours(),_=t.getMinutes()),c=10>c?"0"+String(c):c,_=10>_?"0"+String(_):_,{month:l,day:n,hour:c,minute:_}},_=c("have"),u=_.hour<1?"即将结束":"剩余时间:"+_.day+"天"+_.hour+":"+_.minute,p=c("before"),m="开售时间:"+p.month+"月"+p.day+"日"+p.hour+":"+p.minute,h=c("start"),f="开始:"+h.month+"月"+h.day+"日"+h.hour+":"+h.minute,b=c("end"),g="结束:"+b.month+"月"+b.day+"日"+b.hour+":"+b.minute,w=c("dealEnd"),v="结束时间:"+w.month+"月"+w.day+"日"+w.hour+":"+w.minute;switch(e){case 5:a.html('<p class="sale_step_time">'+m+'</p><p class="sale_step_time">'+v+"</p>"),t.append('<p class="sale_step_time">'+f+'</p><p class="sale_step_time">'+g+"</p>");break;case 6:a.html(u),t.html('<p class="sale_step_time">'+f+'</p><p class="sale_step_time">'+g+"</p>");break;case 7:a.html("已结束"),$(".saleforms_step3").find("h3").html("等待支付尾款"),t.html('<p class="sale_step_time">'+f+'</p><p class="sale_step_time">'+g+"</p>");break;case 8:a.html("已结束"),$(".saleforms_step3").find(".sale_step_detail").css("margin-top","6px"),t.html('<p class="sale_step_time">'+u+"</p>");break;case 9:a.html("已结束"),$(".saleforms_step3").find(".sale_step_detail").css("margin-top","6px"),t.html('<p class="sale_step_time">已结束</p>')}-1!==l&&($(".has_number_size").css({display:"inline-block"}),$(".has_number_detail").css({display:"inline-block"}).find(".has_number_sale").html(l)),$(".saleforms_step").show()},buttonStatus:function(){var e=parseInt(this.requireData.sell_state),a=1===this.requireData.sku_info.skus.length?this.requireData.sku_info.skus[0].sku_no:"",t="",i=$(".deal_img"),l='<span class="deal_solout_img"></span>',r='<span class="deal_solout_full"></span>',n=$("#go_to_cart"),o=$("#foot_car_btn");switch(e){case 1:n.addClass("deal_button_wish");break;case 2:n.addClass("deal_button_cart"),!window.DealDetail.global.isCloseRecommendation.other&&s.init({url:["/i/deal/getStocksNumber?hash_id=","/i/deal/getBrowsesNumber?product_id=","/i/deal/getAddCartNumber?product_id="],ele:".air_bubble_ul"});break;case 3:case 4:var c="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/deal/mobile_subscribe/?id="+window.DealDetail.global.productId;n.addClass("deal_button_soldout").after('<a href="'+c+'" class="deal_button deal_button_tell"></a>'),i.append(l);break;case 5:n.attr("class","deal_button deal_sale_forms_button"),this.dealBooking(e);break;case 6:t=""===a?"#":"http://cart."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/presale/add/"+a+","+window.DealDetail.global.hashId+",1",""!==a&&(n.attr("href",t),o.attr("href",t).attr("target","_blank")),n.attr("class","deal_button deal_sale_forms_money"),$(".saleforms_step1").addClass("saleforms_font_color"),this.dealBooking(e);break;case 7:n.attr("class","deal_button deal_sale_forms_endbp"),$(".saleforms_step2").addClass("saleforms_font_color"),this.dealBooking(e),i.append(r);break;case 8:n.attr("class","deal_button deal_sale_forms_bp").attr("href",d),$(".saleforms_step3").addClass("saleforms_font_color"),this.dealBooking(e);break;case 9:n.attr("class","deal_button deal_sale_forms_end"),i.append(l),this.dealBooking(e)}},dealBuyNum:function(){var e="",a=$("#buy_number"),t=this.requireData.sell_state,i=[1370,1372,1274,1376,1378,1380,382,2175,2176,1385,1387,1389,1394,1396,1403,1405,1407,1409,1411,1414,1426,1434,1440,1444],s=parseInt(window.DealDetail.global.categoryId);if(3===t||4===t||9===t)e+="已抢光";else if(2===t){var l=this.requireData.buyer_number;-1!==$.inArray(s,i)?$(".deal_buynum dt").remove():e='已购买人数<span class="red">'+l+"</span>"}else if(1===t){var r=this.requireData.wish_number;e='已加入心愿单人数<span class="red">'+r+"</span>"}else if(6===t){var n=this.requireData.buyer_number;e='已预定人数<span class="red">'+n+"</span>"}else $(".deal_buynum dt").remove();a.html(e)},skusEvent:function(){if("array"!==$.type(this.requireData.sku_info)){var e,a="",t="",i=this.requireData.sell_state,s=this.requireData.sku_info,l="",r=$(".product_tabs_right"),o=$("#sku_all_detail"),d=s.skus;if(d.length<=1)e=0===d.length?"":d[0].sku_no,a+='<input type="hidden" value="'+e+'" id="sku_no">';else{a+='<input type="hidden" value="" id="sku_no"><div class="select_pro_content"><div class="p_sort_selected"><span id="selected_elem">请选择型号</span><i></i></div><div class="select_all_list">',t+='<div class="deal_tab_wishe_select clearfix">',t+='<span class="xinghao_wish fl">型号：</span>',t+='<div class="deal_tabs_wisha fl">';for(var c=0;c<d.length;c++){var _=d[c],u=_.sku_no,p=_.attribute,m="",h="",f=_.sellable;0===f&&1!==i&&5!==i&&(m='class="data-disable"',h="(卖光了)"),1!==i&&2!==i&&3!==i&&4!==i&&0!==f&&(l='href="http://cart.'+window.DealDetail.global.siteCartTopLevelDomainName+"/i/presale/add/"+u+","+window.DealDetail.global.hashId+',1" target="_blank"'),a+='<a data-hashid="'+u+'" '+m+"><span>"+p+h+"</span></a>",t+='<a  data-hashid="'+u+'" '+l+m+"><span>"+p+h+"</span></a>"}t+="</div></div>",a+="</div></div>"}r.append(t),o.html(a),n.init({ostatus:this.requireData.sell_state})}},newUserRule:function(){var e=Jumei.util.cookie.get("uid"),a=Jumei.util.cookie.get("first_visit"),t=this.requireData.sell_state,i=Jumei.util.cookie.get("order_new_user"),s=$("#p_user_free"),l=$("#p_free_content"),r='<em class="black_back">包邮</em>满299元包邮',n="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/ajax/new_user?callback=?",o=function(){s.find("full_cut_dialog");if(window.DealDetail.global.discountedPrice>=39){var e='<em class="black_back">新人包邮</em>新人专享福利,满39元即可包邮</span>';s.html(e),l.show()}else l.show()};5!==t&&6!==t&&7!==t&&8!==t&&9!==t&&(window.DealDetail.global.discountedPrice>=299&&s.html(r),e&&""===i&&window.DealDetail.global.isCloseRecommendation.groupBuy===!1?$.getJSON(n,function(e){0!==e&&o()}):(a&&!e||e&&1===parseInt(i))&&window.DealDetail.global.isCloseRecommendation.groupBuy===!1?o():l.show())},salesRule:function(){var e=this.requireData.promo_sale_text,a="",t=$(".parent_full_cut"),i={gift:["满赠","manzeng"],reduce_no_cap:["满减","manjian"],reduce:["满减","manjian"],card_no_cap:["满返","manfan"],card:["满返","manfan"],reduce_num:["多件多折","dealmorezhe"],reduce_price:["满折","manzhe"],discount_for_Nth:["第二件折","dealseczhe"],buy_x_free_y:["满就免","dealseczhe"],virtual_product:["满返红包","dealseczhe"]};for(var s in e){var l=e[s];if("undefined"!=typeof i[s]){var r=i[s][0];if(void 0!==r)for(var n=0;n<l.length;n++){a+='<div class="full_cut_dialog"><em>'+r+"</em>",a+='<span class="full_cut_dialog_cn">';var o=l[n];a+=""===o.url?'<a class="full_cut_dialog_a full_cut_dialog_no_a" style="cursor:default;">'+o.show_name+"</a>":'<a class="full_cut_dialog_a"  title="查看详情" target="_blank" href="'+o.url+'">'+o.show_name+"</a>",a+="</span>",a+="</div>"}}}""!==a&&t.append(a).show()},priceHtmlDeal:function(){var e=$(".deal_accout_two"),a=$(".ref_price"),t=$(".deal_out_price"),i=$("#tabs_price"),s=$("#foot_car_btn"),l=$(".deal_self_price"),r=$("#tags_discount"),n=$(".saleform_price"),o=$(".front_price"),c=$(".front_money .saleform_word"),_=window.DealDetail.global.originalPrice,u=window.DealDetail.global.discountedPrice,p=_-u,m="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/deal/mobile_subscribe/?id="+window.DealDetail.global.productId,h=window.DealDetail.global.isPublishedPrice,f=parseInt(this.requireData.sell_state);a.html(_),1!==f&&5!==f||0!==h?(r.css("display","inline-block"),1!==f&&2!==f&&3!==f&&4!==f?(n.html(u),7===f||8===f||9===f?(c.html("尾款"),o.html(window.DealDetail.global.tailFunds)):o.html(window.DealDetail.global.deposit)):e.html(u),i.html(u),0>=p&&l.parent().remove(),p>=10&&t.html('直降<span class="cut_price"><span class="price_size">¥</span>'+Math.round(100*(_-u))/100+"</span>")):t.html('直降<span class="cut_price">¥??</span>'),1===f?s.attr("class","buy deal_add_wish"):2===f?s.attr("class","buy deal_add_cart"):3===f||4===f?s.attr("class","buy deal_add_tell").attr("href",m):5===f?s.attr("class","buy deal_book_button"):6===f?s.attr("class","buy deal_book_money"):7===f?s.attr("class","buy deal_book_endbp"):8===f?s.attr("class","buy deal_book_bp").attr("href",d).attr("target","_blank"):9===f&&s.attr("class","buy deal_book_end")},dealFav:function(){var e=this.requireData.fav_number;r.init({is_fav:e.is_fav,fav_number:e.fav_number})}};t.exports=p}),define("md_streamfb",function(){"use strict";function e(e,a){return Object.prototype.hasOwnProperty.call(e,a)}var a={fb_type:3,search_product_id:0,search_category_id:0,search_brand_id:0,search_page:0,search_pos:0,price:0,search_product_type:"item_deal",search_show_id:0,result_cnt:0,platform:1,search_hash_id:0,search_sku_id:0,search_spu_id:0,search_warehouse_id:0},t={fb_type:"ftype",search_product_id:"spd",search_category_id:"scd",search_brand_id:"sbd",search_page:"spage",search_pos:"spos",price:"price",search_product_type:"spt",search_show_id:"ssd",result_cnt:"rc",search_hash_id:"hid",search_sku_id:"sku",search_spu_id:"spu",search_warehouse_id:"swd"},i={init:function(e,a){i.send(e,a)},send:function(e,s){var l=a;for(var r in l)e.attr(r)&&(l[r]=e.attr(r));var n=$.extend({},l,s),o={stream:"jumei",vl:i.format(n,t)};return window.monitor&&window.monitor.log("custom",o),!0},format:function(a,t){var i,s=[];if(arguments.length>1)for(i in t)if(e(a,i)){var l=t[i];l!=i&&(a[l]=a[i],delete a[i])}for(i in a)s.push(i+"|"+a[i]);return s.join("^")}};window.StreamUtil=i}),define("deal_commit",function(){"use strict";function e(e){var a=c("templates/jumei/js/dealKoubei/css/jumei_deal_report.css");$("head").append('<link rel="stylesheet" href="'+a+'" type="text/css" />'),e&&$("head").append('<link rel="stylesheet" href="'+e+'" type="text/css" />'),$.getScript("http://p0.jmstatic.com/product_report/newKoubei/js/js/12/Ajaxpage.js",function(){$.ajax({url:n+"/ajax/reports_for_deal_page.json?init=1&product_id="+l+"&callback=?",dataType:"jsonp",success:function(e){function a(){{var e=$(".report_attr_select");$(".product_report_tab a.selected")}e.hover(function(){$(this).find("ul").show()},function(){$(this).find("ul").hide()}),e.find("a").click(function(){var e=$(this),a=e.parent().parent().parent("div");return a.find(".age_text").html(e.html()).attr("val",e.attr("val")),a.find(">ul").hide(),o(1,!0),!1}),$(".product_report_tab a").click(function(){{var e=$(this);e.parent().parent().parent("div")}return e.addClass("selected").siblings().removeClass("selected"),o(1,!0),!1})}function i(e){var a=$("#reportwrap span.age_text"),t=a.eq(0).attr("val"),i=a.eq(1).attr("val"),s=$(".product_report_tab a.selected").attr("val");return n+"/ajax/reports_for_deal_page.json?skin_type="+i+"&age="+t+"&rating="+s+"&page_number="+e+"&product_id="+l+"&t="+Math.random()+"&callback=?"}function s(e){if(e.rows.length>0){var a,t=[];$.each(e.rows,function(i){var s=e.rows[i];if(t.push('<li class="pfTrends">'),t.push('    <div class="arrow"></div>'),t.push('    <a href="'+s.user_url+'" rel="nofollow" class="avatar" target="_blank"><img src="'+s.avatar_small+'" alt="'+s.nickname+'"></a>'),"0"!=s.is_valuable&&t.push('    <span class="re_valuable"></span>'),t.push('    <div class="report">'),t.push('        <div class="user_info">'),t.push('            <span class="user_name"><a href="'+s.user_url+'" class="avatar" target="_blank">'+s.nickname+"</a></span>"),s.medals)for(var l in s.medals){var r=s.medals[l];t.push('            <img src="'+r.icon_url+'" title="'+r.title+'" class="vip_icon">')}if(t.push('            <span class="user_attr"> &#12288;'+s.age+","+s.skin_type+","+s.hair_type+"</span>"),t.push('            <div class="rating_wrap">'),t.push('                <div class="rating">'),t.push('                    <div class="value" rating="'+s.rating+'"></div>'),t.push("                </div>"),t.push("            </div>"),t.push("        </div>"),t.push('        <div class="report_content">'),t.push('            <a href="'+s.report_url+'" class="tit" target="_blank">'+s.title+"</a>"),a=s.img_thumbs.length,a>0){t.push('            <div class="thumbImgList">');for(var n=0;a>n&&5>n;n++)t.push('                <a href="'+s.report_url+'" target="_blank"><img src="'+s.img_thumbs[n]+'"></a>');t.push("            </div>")}t.push('            <div class="desc">'),t.push('                <a href="'+s.report_url+'" target="_blank">'+s.content_abstract_300+"</a>"),t.push("            </div>"),t.push('            <div class="gray_f1 pt10">'),t.push('                <div class="txtL">'),t.push("                    "+s.view_count+'阅读<em>|</em><span class="redtxt">'+(s.comment_count<0?0:s.comment_count)+'</span><b>回复</b><em>|</em><span class="redtxt">'+s.shown_support_count+"</span><b>有用</b>"),t.push("                </div>"),t.push('                <div class="cl"></div>'),t.push("            </div>"),t.push("        </div>"),t.push("    </div>"),t.push("</li>")}),t.push('<div class="cl"></div>'),$("#reports_list_wrap").html(t.join("")),t.length=0,$(window.globalPage.opts.pageWrap).show(),$(".all_reports_btn").show(),$("div[rating]").each(function(){this.style.width=this.parentNode.clientWidth*($(this).attr("rating")/5)+"px"})}else $("#reports_list_wrap").html('<img style="margin:30px 0;" src="http://p0.jmstatic.com/product_report/newKoubei/images/deal/1/no_info.png" />'),$(window.globalPage.opts.pageWrap).hide(),$(".all_reports_btn").hide()}function o(a,t){t?$.ajax({url:i(a),dataType:"jsonp",success:function(e){s(e),e.pageCount>1?window.globalPage.refactoringPage(a,e.pageCount):($(".all_reports_btn").hide(),$(window.globalPage.opts.pageWrap).hide())},error:function(){alert("网络请求失败，请刷新重试")}}):(s(e),window.globalPage.refactoringPage(a))}if(0!==e.rows.length){var d=e.filters.product_id,c=['<div class="deal_con product_report" id="product_report">'];c.push('<div id="reportwrap">'),c.push(' <div class="block_title" id="product_report_title">'),c.push('<span style="display:none;">口碑报告</span>'),c.push(" </div>"),c.push("</div>"),c.push('<div id="commentwrap" style="display: none;">'),c.push('<div class="block_title" id="title_comments" >'),c.push('<span style="display:none;">收货评论</span>'),c.push("</div>"),c.push('<div class="deal_con_content">'),c.push('<ul class="comments" id="ul_comments">'),c.push("</ul>"),c.push('<div class="notice">'),c.push('<a href="#" target="_blank">共有<span id="comment_count"></span>条收货短评，点击查看</a>'),c.push("</div>"),c.push("</div>"),c.push(" </div>"),c.push(" </div>"),t.append(c.join("")).find("#reportwrap").append('<div class="lazy" id="reportload">请稍候，正在加载....</div></div>'),c.length=0;var _=$("#reportwrap"),u=$("#reportload"),p=['<div class="deal_con_content">'];if(p.push('<div class="product_report_ranks clearfix">'),e.init_data.reporter_count&&e.init_data.reporter_count>0){p.push('    <div class="rp_score_l">'),p.push('        <span class="tit"></span>'),p.push("        <div>"),p.push('            <h2 class="record_num">'+e.init_data.product_report_rating+"/5</h2>"),p.push('            <div class="rating">'),p.push('                <div class="value" style="width:'+16*e.init_data.product_report_rating+'px;"></div>'),p.push("            </div>"),p.push("        </div>"),p.push('        <p class="pink"><a class="reda" href="'+n+"/report_list-"+d+'.html" target="_blank">'+e.init_data.reporter_count+'</a>口碑&nbsp;&nbsp;<a class="reda" href="'+n+"/comment_list-"+d+'-1.html" target="_blank">'+e.init_data.comments_count+"</a>短评</p>"),p.push("    </div>"),p.push('    <div class="rp_score_c">');var m=e.init_data.splitrating;if(m){p.push('        <dl class="rp_histogram">');var h=0;for(var f in m){var b=m[f];if(h>=6)break;3==h&&(p.push("        </dl>"),p.push('        <dl class="rp_histogram">')),p.push("            <dd>"),p.push('                <span class="icon_red">'+(h+1)+'</span><span class="progress_wrap"><span class="bg" style="width:'+100*b.score/5+'%;"></span><span class="txt">'+b.name+"</span></span>"),p.push("            </dd>"),p.push("            <dt>"+b.score+"</dt>"),h++}p.push("        </dl>")}p.push("    </div>")}p.push('    <div class="rp_score_r"><p>该商品使用起来好用吗？</p>'),p.push("        <p>与超千万聚美用户分享</p>"),p.push("        <p>你的独家心得</p>"),p.push('        <div class="report_share_btn"><a target="_blank" href="'+n+'/user/products#filter=write#page=1">我要写口碑</a>'),p.push("        </div>"),p.push("    </div>"),p.push("</div>"),p.push('  <div class="product_report_filters clearfix">'),p.push('      <div class="product_report_filter">'),p.push('             <div class="report_attr_select">'),p.push('<div class="selected_item">'),p.push('<span class="age_text" val="0">全部年龄</span>'),p.push('<span class="arrow"></span>'),p.push("</div>"),p.push("<ul>");var g,w=[["全部年龄",0],["0-20岁",20],["21-25岁",21],["26-30岁",26],["31-35岁",31],["36-40岁",36],["40岁以上",40]];for(g in w)p.push('<li><a href="javascript:;" type="age" val="'+w[g][1]+'">'+w[g][0]+"</a></li>");p.push("</ul>"),p.push("</div>"),p.push('<div class="report_attr_select">'),p.push('<div class="selected_item">'),p.push('<span class="age_text" val="0">全部肤质</span>'),p.push('<span class="arrow"></span>'),p.push("</div>"),p.push("<ul>");var v,y=[["全部肤质",0],["中性皮肤",1],["干性皮肤",2],["混合性皮肤",3],["油性皮肤",4],["敏感性皮肤",5],["敏感中性皮肤",6],["敏感油性皮肤",7],["敏感干性皮肤",8],["敏感混合性皮肤",9]];for(v in y)p.push('<li><a href="javascript:;" type="skin" val="'+y[v][1]+'">'+y[v][0]+"</a></li>");p.push("</ul>"),p.push("</div>"),p.push("</div>"),p.push("</div>"),p.push('<ul id="reports_list_wrap">'),p.push("</ul>"),e.pageCount>1&&(p.push('<div id="pageSplit">'),p.push("</div>"),p.push('<a href="'+e.product_reviews_url+'" class="all_reports_btn">查看全部口碑报告</a>')),_.append(p.join("")),p.length=0;for(var k in e.init_data.rates[l.toString()]){var D=$("div[rating_av="+k+"]").get(0);D&&(D.style.width=D.parentNode.clientWidth*e.init_data.rates[l.toString()][k].rate+"px")}if($("div[rating_av_star]").each(function(){this.style.width=this.parentNode.clientWidth*(parseInt($(this).attr("rating_av_star"))/5)+"px"}),a(),s(e),_.show(),u.hide(),e.pageCount>1){var x=function(e){o(e,!0),r.scrollTop(t.offset().top)};window.globalPage.initPage({infoTotal:e.rowCount,pageSize:e.rowsPerPage,callback:x,pageNum:8})}}}})})}if(window.DealDetail.global.isCloseRecommendation.koubei)return void $("#report_deal_type").remove();var a=$("#script_koubei"),t=$("#"+a.attr("koubeiWrap")),i=t.offset().top,s=a.attr("cssHref"),l=a.attr("productId"),r=$(window),n="http://koubei.jumei.com",o=a.attr("cssVersion")||0,d=window.jm_webjs_cdn||"http://s0.jmstatic.com/",c=function(e){return d+e+"?"+o},_=function(){var a=$(window).scrollTop();a>i-Math.ceil(r.height())-200&&($(window).unbind("scroll",_),e(s))};i>r.height()?$(window).bind("scroll",_):e(s)}),define("deal_chart",function(){if(window.Jumei_People_Attribute===!1)return!1;jQuery.fn.bubbleSort=function(e){for(var a,t=e.length,i=0;t-2>i;i++)for(var s=t-1;s>=1;s--)e[s].val<e[s-1].val&&(a=e[s],e[s]=e[s-1],e[s-1]=a);return e};var e,a,t,i,s,l,r,n,o,d,c,_;r=parseInt(window.Jumei_People_Attribute.skin_total)+5,a=parseInt(window.Jumei_People_Attribute.skin_oily)+1,t=parseInt(window.Jumei_People_Attribute.skin_dry)+1,i=parseInt(window.Jumei_People_Attribute.skin_neuter)+1,s=parseInt(window.Jumei_People_Attribute.skin_mix)+1,l=parseInt(window.Jumei_People_Attribute.skin_sensitive)+1;var u=(100*parseFloat(a/r)).toFixed(4).toString(),p=(100*parseFloat(t/r)).toFixed(4).toString(),m=(100*parseFloat(i/r)).toFixed(4).toString(),h=(100*parseFloat(s/r)).toFixed(4).toString(),f=(100*parseFloat(l/r)).toFixed(4).toString();n=parseFloat(u.slice(0,u.indexOf(".")+2)),o=parseFloat(p.slice(0,p.indexOf(".")+2)),d=parseFloat(m.slice(0,m.indexOf(".")+2)),c=parseFloat(h.slice(0,h.indexOf(".")+2)),_=parseFloat(f.slice(0,f.indexOf(".")+2)),e=new window.Highcharts.Chart({chart:{renderTo:"chart_skin",width:193,height:150,spacingLeft:0,spacingRight:2},title:{text:"肤质分布"},legend:{align:"left",layout:"vertical",borderWidth:0},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!1},size:"100%",innerSize:"30%",showInLegend:!0}},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>"}},credits:{enabled:!1},series:[{type:"pie",data:[{name:"油性："+n+"%",y:n,color:"#ce1838"},{name:"干性："+o+"%",y:o,color:"#ef599c"},{name:"中性："+d+"%",y:d,color:"#f38ebb"},{name:"混合："+c+"%",y:c,color:"#f8c1d9"},{name:"敏感："+_+"%",y:_,color:"#fde9f1"}]}]});var b,g,w,v,y,k,D,x,I,A,j,M;D=parseInt(window.Jumei_People_Attribute.age_total)+5,g=parseInt(window.Jumei_People_Attribute.age_zero_twenty)+1,w=parseInt(window.Jumei_People_Attribute.age_twenty_twentyfour)+1,v=parseInt(window.Jumei_People_Attribute.age_twentyfive_twentynine)+1,y=parseInt(window.Jumei_People_Attribute.age_thirty_thirtyfour)+1,k=parseInt(window.Jumei_People_Attribute.age_thirtyfive)+1;var C=(100*parseFloat(g/D)).toFixed(4).toString(),E=(100*parseFloat(w/D)).toFixed(4).toString(),T=(100*parseFloat(v/D)).toFixed(4).toString(),S=(100*parseFloat(y/D)).toFixed(4).toString(),z=(100*parseFloat(k/D)).toFixed(4).toString();x=parseFloat(C.slice(0,C.indexOf(".")+2)),I=parseFloat(E.slice(0,E.indexOf(".")+2)),A=parseFloat(T.slice(0,T.indexOf(".")+2)),j=parseFloat(S.slice(0,S.indexOf(".")+2)),M=parseFloat(z.slice(0,z.indexOf(".")+2)),b=new window.Highcharts.Chart({chart:{renderTo:"chart_age",width:223,height:150,spacingLeft:0,spacingRight:2},title:{text:"年龄比例"},legend:{align:"left",layout:"vertical",borderWidth:0},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!1},size:"100%",innerSize:"30%",showInLegend:!0}},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>"}},credits:{enabled:!1},series:[{type:"pie",data:[{name:"20岁以下："+x+"%",y:x,color:"#ce1838"},{name:"20-24岁："+I+"%",y:I,color:"#ef599c"},{name:"25-29岁："+A+"%",y:A,color:"#f38ebb"},{name:"30-34岁："+j+"%",y:j,color:"#f8c1d9"},{name:"35岁以上："+M+"%",y:M,color:"#fde9f1"}]}]});var N,O,P,J,L,F={},q={},R={},B={},H={},V={},U={},W={},K={},G={},X={},Q={},Y=[],Z=[];O=parseInt(window.Jumei_People_Attribute.constellation_total)+12,F.key="水瓶座",F.val=parseInt(window.Jumei_People_Attribute.aquarius)+1,q.key="白羊座",q.val=parseInt(window.Jumei_People_Attribute.aries)+1,R.key="巨蟹座",R.val=parseInt(window.Jumei_People_Attribute.cancer)+1,B.key="摩羯座",B.val=parseInt(window.Jumei_People_Attribute.capricorn)+1,H.key="双子座",H.val=parseInt(window.Jumei_People_Attribute.gemini)+1,V.key="狮子座",V.val=parseInt(window.Jumei_People_Attribute.leo)+1,U.key="天秤座",U.val=parseInt(window.Jumei_People_Attribute.libra)+1,W.key="双鱼座",W.val=parseInt(window.Jumei_People_Attribute.pisces)+1,K.key="射手座",K.val=parseInt(window.Jumei_People_Attribute.sagittarius)+1,G.key="天蝎座",G.val=parseInt(window.Jumei_People_Attribute.scorpio)+1,X.key="金牛座",X.val=parseInt(window.Jumei_People_Attribute.taurus)+1,Q.key="处女座",Q.val=parseInt(window.Jumei_People_Attribute.virgo)+1;var ea=[];ea.push(F,q,R,B,H,V,U,W,K,G,X,Q),ea=$.fn.bubbleSort(ea).reverse(),P=O;for(var aa=0;5>aa;aa++)5>aa&&(Y[aa]=(100*parseFloat(ea[aa].val/O)).toFixed(4).toString(),Z[aa]=parseFloat(Y[aa].slice(0,Y[aa].indexOf(".")+2)),P-=ea[aa].val);J=(100*parseFloat(P/O)).toFixed(4).toString(),L=parseFloat(J.slice(0,J.indexOf(".")+2)),N=new window.Highcharts.Chart({chart:{renderTo:"chart_constellation",type:"pie",width:208,height:160,spacingLeft:0,spacingRight:5},title:{text:"星座分布",style:{marginBottom:"5px"}},legend:{enabled:!0,layout:"vertical",align:"left",labelFormatter:function(){return this.name},borderWidth:0},plotOptions:{pie:{cursor:"pointer",dataLabels:{enabled:!1},size:"100%",innerSize:"30%",showInLegend:!0}},tooltip:{formatter:function(){return"<b>"+this.point.name+"</b>"}},credits:{enabled:!1},series:[{data:[{name:ea[0].key+"："+Z[0]+"%",y:Z[0],color:"#ce1838"},{name:ea[1].key+"："+Z[1]+"%",y:Z[1],color:"#ef599c"},{name:ea[2].key+"："+Z[2]+"%",y:Z[2],color:"#f38ebb"},{name:ea[3].key+"："+Z[3]+"%",y:Z[3],color:"#f59ab8"},{name:ea[4].key+"："+Z[4]+"%",y:Z[4],color:"#f8c1d9"},{name:"其他："+L+"%",y:L,color:"#fde9f1"}]}]})}),define("deal_history",function(){"use strict";var e={ele:$("#browse_history .slideBar_ul"),url:"/i/ajax/get_view_history"},a={ele:$("#br_slide .cs_list"),url:"/i/ajax/get_recommend_by_history"},t=$("#search_product_id").val(),i=function(){var e=new Jumei.ui.Carousel("#browse_history_carousel",{singleSlide:!1,indexSwitch:!1});e.on("toStart",function(){}),e.on("toEnd",function(){}),e.on("slided",function(){})},s=function(e){e.find("img").each(function(){var e=$(this),a=e.attr("lazyload");a&&e.attr("src",a)})},l=function(){var a=function(a){if(a&&a.length){for(var t="",i=0;i<a.length;i++){var s=a[i],l=parseInt(s.product_reports_number)||0,r=parseInt(s.deal_comments_number)||0,n=l+r?l+r+"篇评价":"新品上市";t+="<li>",t+='<div class="left_part">',t+='<a target="_blank" title="'+s.short_name+'" href="'+s.url+"?from=deal_detail_foot_history_null_pos"+i+'">',t+='<img lazyload = "'+s.image_60+'"></a>',t+="</div>",t+='<div class="right_part">',t+='<p class="name">',t+='<a target="_blank" title="'+s.short_name+'" href="'+s.url+"?from=deal_detail_foot_history_null_pos"+i+'">',t+=s.short_name+"</a>",t+="</p>",t+='<p class="price">¥'+s.discounted_price+"<span>"+(parseFloat(s.discount)<9.5?"("+a[i].discount+"折)":"")+"</p>",t+='<p class="buycount">'+n+"</p>",t+="</div>",t+="</li>"}e.ele.html(t)}else e.ele.html('<p style="text-align:center;margin-top: 120px;">你最近没有浏览过聚美商品，<br>快去逛逛吧~</p>');$("#browse_history").show()},t="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+e.url;$.ajax({url:t,dataType:"jsonp",jsonp:"callback",success:function(e){a(e)},complete:function(){s(e.ele)}})},r=function(){var e=function(e){if(e&&e.length>0){for(var s="",l=0;l<e.length;l++){var r=e[l],n=parseInt(r.product_reports_number)||0,o=parseInt(r.deal_comments_number)||0,d=n+o?n+o+"篇评价":"新品上市",c=parseInt(l)+1,_=c%4===0?c/4:parseInt(c/4)+1,u=c%4===0?4:c%4;s+='<li><a href="'+r.url+"?from=r_d_f_"+t+"_"+_+"-"+u+'" title="'+r.short_name+'" target="_blank">',s+='<img lazyload="'+r.image_200+'" class="pic" width="160" height="160" alt="'+r.short_name+'"/></a>',s+='<p class="tit"><a href="'+e[l].url+"?from=r_d_f_"+t+"_"+_+"-"+u+'" title="'+r.short_name+'" target="_blank">'+r.short_name+"</a></p>",s+='<p class="price">￥'+e[l].mall_price+'<span style="color:#919191">'+(parseFloat(r.discount)<9.5?"("+r.discount+"折)":"")+'</span></p><p class="count">'+d+"</p>"}a.ele.html(s),i()}else a.ele.html('<p style="text-align:center;margin-top:120px;">对不起，暂时没有数据！</p>');$("#browse_history").show()},l="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+a.url;$.ajax({url:l,dataType:"jsonp",jsonp:"callback",success:function(a){e(a)},complete:function(){s(a.ele)}})};if(!window.DealDetail.global.isCloseRecommendation.browse){l(),r();var n="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/ajax/set_history";$.ajax({url:n,dataType:"jsonp",jsonp:"callback",data:{hid:window.DealDetail.global.hashId}})}}),define("deal_sidebar",function(){"use strict";function e(e){"array"!==$.type(e)&&(e=e.sidebar_service,o.append(e.join("")))}var a={same_band_introduce:{title:"同品牌推荐",from:"r_d_b",isShow:window.DealDetail.global.isCloseRecommendation.brand,url:"/i/ajax/get_deal_same_brand"},same_type_introduce:{title:"同类型推荐",from:"r_d_c",isShow:window.DealDetail.global.isCloseRecommendation.category,url:"/i/ajax/get_deal_same_cate"},same_new_introduce:{title:"新品爆款",from:"r_d_n",isShow:window.DealDetail.global.isCloseRecommendation["new"],url:"/i/ajax/get_deal_new_hot_sale"}},t=function(e){var a;switch(e){case"same_band_introduce":a={list:{pid:window.DealDetail.global.productId,brand_id:window.DealDetail.global.brandId,limit:10},type:"brand_id"};break;case"same_type_introduce":a={list:{pid:window.DealDetail.global.productId,category_id:window.DealDetail.global.categoryId,limit:10},type:"brand_id"};break;case"same_new_introduce":a={list:{pid:window.DealDetail.global.productId,cid:window.DealDetail.global.categoryId,bid:window.DealDetail.global.brandId,limit:10},type:"new_hot"}}return a},i=function(e){e.find("img").each(function(){var e=$(this),a=e.attr("lazy-src")||e.attr("original");a&&e.attr("src",a)})},s=function(e,i){var s="",l=t(i),r=a[i].from,n='<span class="global_red">[极速免税店]</span>',o=a[i].title;s+='<h3 class="slideBar_title">'+o+"</h3>",s+='<div class="slideBar_content">',"same_band_introduce"===i&&(s+='<div class="slidebar_brand_img">',s+='<img style="width:120px; height:60px;" src="http://p0.jmstatic.com/brand/logo_180/'+window.DealDetail.global.brandId+'.jpg" onerror="$(this).parent().hide()">',s+="</div>"),s+='<ul class="slideBar_ul">';for(var d=0;d<e.length;d++){{var c=e[d],_=c.short_name,u=c.hash_id,p=c.category,m="brand_id"===l.type?c.url:c.url||c.detailUrl,h="brand_id"===l.type?c.image_60:c.image||c.imgUrl,f="undefined"==typeof u?c.mall_price:c.discounted_price,b=c.discount,g=c.sales_channel,w=m+"?from="+r+"_"+window.DealDetail.global.productId+"_1-"+d,v=parseInt(b)>=9.5?"":"<span> ("+b+"折)</span>";"undefined"!=typeof c.sales_channel&&"mall"===g?"已有"+c.buyer_number+"人购买":"商城售卖"}s+=d===e.length-1?'<li class="no_border">':"<li>",s+='<div class="left_part">',s+='<a target="_blank" title="'+_+'" href="'+w+'">',s+='<img lazy-src="'+h+'"></a>',s+="</div>",s+='<div class="right_part">',s+='<p class="name">',s+='<a target="_blank" title="'+_+'" href="'+w+'">',s+="retail_global"===p||"global"===p||"combination_global"===p?n+_+"</a>":_+"</a>",s+="</p>",s+='<p class="price">¥'+f+v+"</p>",s+="</div>",s+="</li>"
}s+="</ul>",s+="</div>",e.length>0&&$("#"+i).html(s).show()},l=function(e){var l=$("#"+e);if(l.length>0&&!a[e].isShow){var r="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+a[e].url,n=t(e);$.ajax({url:r,dataType:"jsonp",jsonp:"callback",data:n.list,success:function(a){s(a,e)},complete:function(){i(l)}})}};for(var r in a)l(r);var n="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/static/getDealDetailAdvInfo?locations=sidebar_service",o=$(".product_detail_r");$.ajax({url:n,dataType:"jsonp",jsonp:"callback",success:function(a){e(a)},complete:function(){i($(".service_box"))}})}),define("deal",["deal_sidebar","deal_history","deal_chart","deal_commit","md_streamfb","top_main","bottom_main","shopping"],function(e){"use strict";e("deal_sidebar"),e("deal_history"),e("deal_chart"),e("deal_commit"),e("md_streamfb");var a=e("top_main"),t=e("bottom_main"),i=e("shopping"),s="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME+"/i/static/getDealInfoByHashId?hash_id="+window.DealDetail.global.hashId+"&brand_id="+window.DealDetail.global.brandId,l={};l={requireData:{},init:function(){var e=this,a=function(a){"array"===$.type(a)&&a.length<=0?window.location.href="http://www."+JM.SITE_MAIN_TOPLEVELDOMAINNAME:(e.requireData=a,e.dealEventFun())};window.DealDetail.ajaxData?a(window.DealDetail.ajaxData):$.ajax({url:s,dataType:"jsonp",jsonp:"callback",success:function(e){a(e)}})},dealEventFun:function(){var e=this.requireData,s=this.requireData.sell_state,l='<input type="hidden"id="stream_id" search_product_id="'+window.DealDetail.global.productId+'"search_category_id="'+window.DealDetail.global.categoryId+'" search_brand_id="'+window.DealDetail.global.brandId+'"price="'+window.DealDetail.global.discountedPrice+'">';$("body").append(l),3===s||4===s?(void 0===window.DealDetail.global.isCloseRecommendation.clickMap||window.DealDetail.global.isCloseRecommendation.clickMap===!1)&&window.StreamUtil.init($("#stream_id"),{result_cnt:-1}):(void 0===window.DealDetail.global.isCloseRecommendation.clickMap||window.DealDetail.global.isCloseRecommendation.clickMap===!1)&&window.StreamUtil.init($("#stream_id")),a.init(e),t.init(e),i.init(e)}},l.init();{var r=$("#product_deal_tabs");$("#koubei_report_newdeal")}$(".deal_buynum .deal_koubei").on("click","#koubei_report_newdeal",function(){$("#report_deal_type").trigger("click")}),r.find("li").click(function(){var e=$(this).find("a").attr("href");if(!e)return!0;var a=$(e);if("loaded"!=a.attr("loaded")){var t=a.find("textarea").val();a.attr("loaded","loaded"),a.find("textarea").parent().html(t),a.find("textarea").css("visibility","visible")}$(this).find("a").addClass("current"),$(this).siblings("li").find("a").removeClass("current")}),new Jumei.ui.Lazyload(".product_info_detail .deal_lazy_text",{type:"dom"});var n={};n={init:function(){var e=$(".product_info_detail");this.loadImg(e),Jumei.ui.Tab("#product_promise_tabs",{auto:!0,interval:2e3,trigger:"mouseenter"})},loadImg:function(e){e.find(".deal_lazy_img").each(function(){var e=$(this),a=e.attr("data-lazysrc");a&&e.attr("src",a)})}},n.init(),$("#serving_fav_tell").click(function(){var e=$("#iBar li.mpbtn_support a");e&&e.trigger("click")})}),seajs.use(["app","deal"],function(){var e="http://cart."+window.DealDetail.global.siteCartTopLevelDomainName+"/i/cart/ajax_add_to_cart";new Jumei.app.iBar({addCartAjaxUrl:e})});